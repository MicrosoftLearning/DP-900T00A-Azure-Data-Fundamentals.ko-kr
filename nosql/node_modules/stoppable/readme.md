---
ms.openlocfilehash: 03ad292b1fceecb8974f1d8753cb47723344dbf3
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052538"
---
# <a name="stoppable"></a>중지 가능

[![빌드 상태](https://travis-ci.org/hunterloftis/stoppable.svg?branch=master)](https://travis-ci.org/hunterloftis/stoppable)

> 노드의 `server.close()`는 기본적으로 작동할 것으로 [예상한 방식입니다](https://github.com/nodejs/node/issues/2642).

## <a name="summary"></a>요약

```js
const server = stoppable(http.createServer(handler))
server.stop()
```

중지 가능은 새 연결 수락을 중지하고, 현재 상태인 요청을 종료하지 않고 기존 유휴 연결(연결 유지 포함)을 닫습니다.

## <a name="requirements"></a>요구 사항

- Node.js v6+

Node.js v4.x는 비공식적으로 지원됩니다.

## <a name="installation"></a>설치

```bash
yarn add stoppable
```

(또는 npm 사용)

## <a name="usage"></a>사용량

**생성자**

```js
stoppable(server, grace)
```

`stop` 메서드를 사용하여 서버 인스턴스를 데코레이트합니다.
서버 인스턴스를 반환하므로 연결하거나 독립 실행형 문으로 실행할 수 있습니다.

- 서버: 모든 HTTP 또는 HTTPS 서버 인스턴스
- 유예 기간: 연결을 강제 종료하기 전에 대기하는 밀리초

`grace` 기본값은 무한대로 설정됩니다(강제 닫지 않음).
모든 소켓을 즉시 종료하려면 0의 유예 기간을 사용할 수 있습니다.

**stop()**

```js
server.stop(callback)
```

서버를 닫습니다.

- 콜백: 기존 `server.close` 함수에 전달되어 ‘close’ 이벤트를 자동으로 등록합니다.
첫 번째 집계는 오류이며 두 번째 인수는 정상적으로 중지되었는지 여부를 나타내는 부울입니다.

## <a name="design-decisions"></a>디자인 의사 결정

- 원숭이 패치는 일반적으로 형편없지만 이 경우 가장 좋은 API입니다. “데코레이팅”이라고 부르겠습니다.
- `grace`는 `stop`에 지정할 수 있지만 기존 `server.close` API와 일치시키는 것이 좋습니다.
- 클라이언트는 정중하게 처리되어야 하므로 소켓을 파괴하는 것이 아니라 먼저 `FIN` 패킷을 전송합니다.
- 이 문제에 대한 해결 방법을 사용하려면 모든 연결 및 요청/응답에 대한 부기 작업이 필요합니다.
이러한 “핫” 코드 경로에 대해 최소한의 작업을 수행하고 실제 `stop` 메서드로 최대한 지연하고 있습니다.

## <a name="performance"></a>성능

연결, 연결 끊김, 요청, 응답에 대한 부기 없이 이 기능을 제공할 수 있는 방법은 없습니다.
그러나 중지 가능은 핫 코드 경로에서 최소한의 작업을 수행하고 최적의 데이터 구조를 사용하기 위해 노력합니다.

실제 성능 벤치마크를 보고 싶습니다. 라이브러리에 포함된 간단한 루프백 포병 벤치마크는 중지 가능한 서버를 사용하는 오버헤드를 거의 표시하지 않습니다.

### <a name="without-stoppable"></a>중지 가능 없음

```plain
  Scenarios launched:  10000
  Scenarios completed: 10000
  Requests completed:  10000
  RPS sent: 939.85
  Request latency:
    min: 0.5
    max: 51.3
    median: 2.1
    p95: 3.7
    p99: 15.3
  Scenario duration:
    min: 1
    max: 60.7
    median: 3.6
    p95: 7.6
    p99: 19
  Scenario counts:
    0: 10000 (100%)
  Codes:
    200: 10000
```

### <a name="with-stoppable"></a>중지 가능 있음

```plain
  Scenarios launched:  10000
  Scenarios completed: 10000
  Requests completed:  10000
  RPS sent: 940.73
  Request latency:
    min: 0.5
    max: 43.4
    median: 2.1
    p95: 3.8
    p99: 15.5
  Scenario duration:
    min: 1.1
    max: 57
    median: 3.7
    p95: 8
    p99: 19.4
  Scenario counts:
    0: 10000 (100%)
  Codes:
    200: 10000
```

## <a name="license"></a>License

MIT