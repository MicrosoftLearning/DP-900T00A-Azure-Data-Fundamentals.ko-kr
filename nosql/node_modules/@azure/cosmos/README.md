---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052490"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>JavaScript/TypeScript용 Azure Cosmos DB 클라이언트 라이브러리

[![최신 npm 배지](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![빌드 상태](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB는 문서, 키-값, 넓은 열 및 그래프 데이터베이스를 지원하는 전세계로 분산된 다중 모델 데이터베이스 서비스입니다. 이 패키지는 JavaScript/Typescript 애플리케이션이 **SQL API** 데이터베이스 및 포함된 JSON 문서와 상호 작용하기 위한 것입니다.

- Cosmos DB 데이터베이스 만들기 및 설정 수정
- JSON 문서의 컬렉션을 저장하도록 컨테이너 만들기 및 수정
- 컨테이너에서 항목(JSON 문서) 만들기, 읽기, 업데이트, 삭제
- SQL 유사 구문을 사용하여 데이터베이스의 문서 쿼리

주요 링크:

- [패키지(npm)][npm]
- [API 참조 설명서](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [제품 설명서][cosmos_docs]

## <a name="getting-started"></a>시작

### <a name="prerequisites"></a>필수 조건

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Azure 구독 및 Cosmos DB SQL API 계정

이 패키지를 사용하려면 [Azure 구독][azure_sub]과 [Cosmos DB 계정][cosmos_account](SQL API)이 있어야 합니다.

Cosmos DB SQL API 계정이 필요한 경우 Azure [Cloud Shell][cloud_shell_bash]을 사용하여 다음 Azure CLI 명령을 통해 만들 수 있습니다.

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

또는 [Azure Portal](https://portal.azure.com/#create/microsoft.documentdb)에서 계정을 만들 수 있습니다.

#### <a name="nodejs"></a>NodeJS

이 패키지는 [NodeJS](https://nodejs.org/en/)와 함께 미리 설치된 [npm][npm]을 통해 배포됩니다. Node v10 이상을 사용해야 합니다.

#### <a name="cors"></a>CORS

브라우저용으로 개발해야 하는 경우 Cosmos DB 계정에 대해 [CORS(원본 간 리소스 공유)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) 규칙을 설정해야 합니다. 연결된 문서의 지침에 따라 Cosmos DB에 대한 새 CORS 규칙을 만듭니다.

### <a name="install-this-package"></a>이 패키지 설치

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>계정 자격 증명 가져오기

Cosmos DB **계정 엔드포인트** 및 **키** 가 필요합니다. [Azure Portal](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts)에서 찾거나 아래의 [Azure CLI][azure_cli] 코드 조각을 사용할 수 있습니다. 조각은 Bash 셸에 대해 서식이 지정됩니다.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>`CosmosClient`의 인스턴스 만들기

Cosmos DB와의 상호 작용은 [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest) 클래스의 인스턴스로 시작됩니다.

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

간단히 하기 위해 코드에 `key` 및 `endpoint`가 직접 포함되었지만 [dotenv](https://www.npmjs.com/package/dotenv)와 같은 프로젝트를 사용하거나 환경 변수에서 로드하는 등 소스 제어에 없는 파일에서 로드하려고 할 수 있습니다.

프로덕션 환경에서 키와 같은 비밀은 [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)에 저장해야 합니다.

## <a name="key-concepts"></a>주요 개념

[CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates)를 초기화한 후에는 Cosmos DB의 기본 리소스 종류와 상호 작용할 수 있습니다.

- [데이터베이스](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest): Cosmos DB 계정은 여러 데이터베이스를 포함할 수 있습니다. 데이터베이스를 만드는 경우 문서와 상호 작용할 때 사용할 API를 지정합니다. SQL, MongoDB, Gremlin, Cassandra 또는 Azure Table. [데이터베이스](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) 개체를 사용하여 컨테이너를 관리합니다.

- [컨테이너](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest): 컨테이너는 JSON 문서의 컬렉션입니다. [컨테이너](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest) 개체의 메서드를 사용하여 컨테이너에서 항목을 만들고(삽입), 읽기, 업데이트, 삭제합니다.

- [항목](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): 항목은 컨테이너에 저장된 JSON 문서입니다. 각 항목에는 컨테이너 내에서 항목을 고유하게 식별하는 값이 있는 `id` 키가 포함되어야 합니다. `id`를 제공하지 않으면 SDK가 자동으로 생성합니다.

이러한 리소스에 대한 자세한 내용은 [Azure Cosmos 데이터베이스, 컨테이너, 항목 작업][cosmos_resources]을 참조하세요.

## <a name="examples"></a>예제

다음 섹션에서는 다음을 비롯한 가장 일반적인 Cosmos DB 작업 몇 가지에 대한 여러 코드 조각을 제공합니다.

- [데이터베이스 만들기](#create-a-database)
- [컨테이너 만들기](#create-a-container)
- [항목 삽입](#insert-items)
- [문서 쿼리](#query-the-database)
- [항목 읽기](#read-an-item)
- [항목 삭제](#delete-an-data)

### <a name="create-a-database"></a>데이터베이스 만들기

[CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)를 인증한 후 계정의 모든 리소스로 작업할 수 있습니다. 아래 코드 조각은 SQL API 데이터베이스를 만듭니다.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>컨테이너 만들기

이 예제에서는 기본 설정을 사용하여 컨테이너를 만듭니다.

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>항목 삽입

컨테이너에 항목을 삽입하려면 데이터가 포함된 개체를 [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-)에 전달합니다. Cosmos DB 서비스에는 각 항목에 `id` 키가 있어야 합니다. `id`를 제공하지 않으면 SDK가 자동으로 생성합니다.

다음은 컨테이너에 여러 항목을 삽입하는 예제입니다.

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>항목 읽기

컨테이너에서 단일 항목을 읽으려면 [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-)를 사용합니다. 이는 SQL을 사용하여 `id`로 쿼리하는 것보다 비용이 적게 드는 작업입니다.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>항목 삭제

컨테이너에서 항목을 삭제하려면 [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-)를 사용합니다.

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>데이터베이스 쿼리

Cosmos DB SQL API 데이터베이스는 SQL 유사 구문을 사용하여 [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-)로 컨테이너의 항목 쿼리를 지원합니다.

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

매개 변수 및 해당 값이 포함된 개체를 [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-)에 전달하여 매개 변수화된 쿼리를 수행합니다.

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

SQL API를 사용하여 Cosmos DB 데이터베이스를 쿼리하는 방법에 대한 자세한 내용은 [SQL 쿼리를 사용하여 Azure Cosmos DB 데이터 쿼리][cosmos_sql_queries]를 참조하세요.

## <a name="troubleshooting"></a>문제 해결

### <a name="general"></a>일반

서비스에서 반환된 Cosmos DB 오류와 상호 작용할 때 REST API 요청에 대해 반환된 것과 동일한 HTTP 상태 코드에 해당합니다.

[Azure Cosmos DB에 대한 HTTP 상태 코드][cosmos_http_status_codes]

#### <a name="conflicts"></a>충돌

예를 들어 Cosmos DB 데이터베이스에서 이미 사용 중인 `id`를 사용하여 항목을 만들려고 하면 충돌을 나타내는 `409` 오류가 반환됩니다. 다음 코드 조각에서 오류는 예외를 catch하고 오류에 대한 추가 정보를 표시하여 적절히 처리됩니다.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>트랜스파일링

Azure SDK는 ES5 JavaScript 구문 및 [LTS 버전의 Node.js](https://nodejs.org/about/releases/)를 지원하도록 설계되었습니다. Internet Explorer 또는 노드 6과 같은 이전 JavaScript 런타임에 대한 지원이 필요한 경우 빌드 프로세스의 일부로 SDK 코드를 트랜스파일링해야 합니다.

### <a name="handle-transient-errors-with-retries"></a>재시도를 통한 일시적인 오류 처리

Cosmos DB를 사용하는 동안 서비스에 적용된 [요금 제한][cosmos_request_units]에 의한 일시적인 오류나 네트워크 중단과 같은 다른 일시적인 문제가 발생할 수 있습니다. 이러한 유형의 오류를 처리하는 방법에 대한 내용은 클라우드 디자인 패턴 가이드의 [다시 시도 패턴][azure_pattern_retry] 및 관련 [회로 차단기 패턴][azure_pattern_circuit_breaker]을 참조하세요.

## <a name="next-steps"></a>다음 단계

### <a name="more-sample-code"></a>추가 샘플 코드

SDK의 GitHub 리포지토리에서 [여러 샘플][cosmos_samples]을 사용할 수 있습니다. 이러한 샘플에는 Cosmos DB를 사용하는 동안 흔히 발생하는 추가 시나리오에 대한 예제 코드가 들어 있습니다.

- 데이터베이스 작업
- 컨테이너 작업
- 항목 작업
- 인덱싱 구성
- 컨테이너 변경 피드 읽기
- 저장 프로시저
- 데이터베이스/컨테이너 처리량 설정 변경
- 다중 지역 쓰기 작업

### <a name="additional-documentation"></a>추가 설명서

Cosmos DB 서비스에 대한 보다 광범위한 설명서는 docs.microsoft.com에 있는 [Azure Cosmos DB 문서][cosmos_docs]를 참조하세요.

## <a name="useful-links"></a>유용한 링크

- [Azure Cosmos DB 시작](https://docs.microsoft.com/azure/cosmos-db/community)
- [빠른 시작](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [자습서](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [샘플](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Azure Cosmos DB 서비스의 리소스 모델 소개](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Azure Cosmos DB 서비스의 SQL API 소개](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [분할](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [API 문서](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>참여

이 라이브러리에 기여하려면 [기여 가이드](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) 를 참조하여 코드를 빌드하고 테스트하는 방법에 대해 자세히 알아보세요.

![Impressions](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
